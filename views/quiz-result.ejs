<%- include('partials/header') %>

<div class="result-container">
    <div class="result-summary">
        <h2 class="page-title">採点結果</h2>
        <h3 class="quiz-title-result"><%= quiz.title %></h3>
        <div class="score-display">
            <span class="score-value"><%= totalScore %></span>
            <span class="score-divider">/</span>
            <span class="score-max"><%= maxScore %></span>
            <span class="score-label">点</span>
        </div>
        <p class="result-message">
            <% if (totalScore / maxScore >= 0.8) { %>
                素晴らしい成績です！よく頑張りました！
            <% } else if (totalScore / maxScore >= 0.5) { %>
                お疲れ様でした。よくできています！
            <% } else { %>
                お疲れ様でした。間違えた問題を復習しましょう。
            <% } %>
        </p>
    </div>

    <div class="results-list">
        <% results.forEach((result, index) => { %>
            <div class="result-item <%= result.is_correct ? 'correct' : 'incorrect' %>">
                <div class="result-item-header">
                    <span class="question-number">問題 <%= index + 1 %></span>
                    <span class="question-points">(<%= result.points %>点)</span>
                    <span class="result-mark"><%= result.is_correct ? '正解' : '不正解' %></span>
                </div>
                <p class="question-text-result"><%= result.question %></p>
                
                <div class="answer-group">
                    <div class="answer-box your-answer">
                        <div class="answer-label">あなたの解答</div>
                        <p class="answer-text"><%= result.user_answer || '(無回答)' %></p>
                    </div>
                    
                    <!-- ★★★ ここからが追加部分 ★★★ -->
                    <% if (!result.is_correct) { %>
                        <div class="answer-box correct-answer">
                            <div class="answer-label">正解</div>
                            <p class="answer-text"><%= result.correct_answer %></p>
                        </div>
                    <% } %>
                    <!-- ★★★ ここまでが追加部分 ★★★ -->
                </div>

                <div class="feedback-box">
                    <div class="feedback-label">フィードバック (獲得点数: <%= result.score %>点)</div>
                    <p class="feedback-text"><%= result.feedback %></p>
                </div>
            </div>
        <% }); %>
    </div>

    <div class="result-actions">
        <% if (isDraft) { %>
            <form action="/quiz/save-draft" method="POST" style="display: inline;">
                <input type="hidden" name="quizData" value='<%- JSON.stringify(quiz) %>'>
                <button type="submit" class="button">この問題を保存する</button>
            </form>
            <a href="/quiz/create" class="button secondary">新しい問題を作る</a>
        <% } else { %>
            <a href="/quiz/my-quizzes" class="button">作成一覧に戻る</a>
            <a href="/public-quizzes" class="button secondary">他の問題を探す</a>
        <% } %>
    </div>
</div>

<%- include('partials/footer') %>